dnl -*- mode: shell-script -*-
dnl Process this file with autoconf to produce a configure script.

AC_INIT(IDL.h)
AM_INIT_AUTOMAKE(libIDL, 0.1)

dnl Checks for programs.
AC_PROG_CC
AC_PROG_CPP
AC_PROG_PLAIN_CPP
AC_PROG_PLAIN_CPP_EXEC
CPP_PROGRAM="$PLAIN_CPP"
AC_DEFINE_UNQUOTED(CPP_PROGRAM, "$PLAIN_CPP")

AM_PROG_LEX
if [[ "$LEX" = "flex" ]]; then
    LFLAGS="-8"
else
    LFLAGS=""
fi
AC_SUBST(LFLAGS)
AC_PROG_YACC

AC_PROG_RANLIB

dnl Checks for libraries.
AC_CHECK_PROG(HAVE_GLIB_CONFIG, glib-config, yes, no)

if test "$HAVE_GLIB_CONFIG" != "yes"; then
	echo "You must have glib installed."
	exit 1
fi
GLIB_INCLUDES=`glib-config --cflags`
GLIB_LIBS=`glib-config --libs`
AC_SUBST(GLIB_INCLUDES)
AC_SUBST(GLIB_LIBS)

AC_ISC_POSIX

AC_STDC_HEADERS
AC_CHECK_HEADERS(stddef.h wchar.h wcstr.h)

AC_CHECK_FUNCS(strdup)

AC_OUTPUT(Makefile)

echo
echo libIDL configuration complete
echo
echo "  Standalone C Preprocessor: \"$PLAIN_CPP\""
if [[ "$ac_prog_plain_cpp_exec" = no ]]; then
    cat <<EOF

  WARNING: Could not execute C preprocessor \`$PLAIN_CPP'; IDL parsing
           may fail.  GNU cpp is recommended.  Install GNU cpp and
           rerun configure, with the --with-plain-cpp=PROGRAM argument
           if necessary.
EOF
fi
echo